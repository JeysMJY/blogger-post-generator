<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Generator - Movie Streaming (V3 Responsive)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: #f0f2f5; padding: 20px 0; }
        .card { border: none; border-radius: 15px; box-shadow: 0 8px 24px rgba(0,0,0,0.05); }
        .episode-card { background: #ffffff; border: 1px solid #eee; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        .download-row { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #0d6efd; }
        #finalCode, #importCodeArea { font-family: 'Fira Code', monospace; font-size: 11px; height: 350px; background: #282c34; color: #abb2bf; }
        .btn-remove { color: #dc3545; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-remove:hover { color: #a71d2a; }
        .section-title { border-left: 5px solid #0d6efd; padding-left: 15px; margin-bottom: 25px; font-weight: 700; color: #333; }
        .preview-container { margin-top: 10px; position: relative; display: none; }
        .preview-container img { border-radius: 8px; border: 2px solid #ddd; object-fit: cover; background: #eee; }
        .poster-prev { width: 100px; height: 150px; }
        .banner-prev { width: 100%; height: 150px; }
        .sticky-code { position: sticky; top: 20px; }
        @media (max-width: 991px) { .sticky-code { position: relative; top: 0; margin-top: 30px; } }
    </style>
</head>
<body>

<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card p-4">
                <h4 class="section-title"><i class="fa fa-file-import me-2"></i> IMPORT DATA</h4>
                <textarea id="importCodeArea" class="form-control mb-3" placeholder="Tempel kode postingan lama di sini untuk mengedit..."></textarea>
                <div class="d-flex gap-2">
                    <button class="btn btn-dark flex-grow-1" onclick="importData()"><i class="fa fa-bolt me-2"></i>MUAT DATA</button>
                    <button class="btn btn-outline-danger" onclick="resetForm()"><i class="fa fa-trash-can me-2"></i>RESET</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-7">
            <div class="card p-4 mb-4">
                <h4 class="section-title"><i class="fa fa-film me-2"></i> MOVIE INFO</h4>
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label small fw-bold">Judul Film / Series</label>
                        <input type="text" id="m_title" class="form-control" placeholder="Contoh: Tinggal Meninggal">
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label small fw-bold">Poster URL</label>
                        <input type="text" id="m_poster" class="form-control" placeholder="https://..." oninput="showPreview(this, 'poster_p')">
                        <div id="poster_p" class="preview-container">
                            <span class="badge bg-dark mb-1">Preview Poster</span><br>
                            <img src="" class="poster-prev">
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <label class="form-label small fw-bold">Banner URL</label>
                        <input type="text" id="m_banner" class="form-control" placeholder="https://..." oninput="showPreview(this, 'banner_p')">
                        <div id="banner_p" class="preview-container">
                            <span class="badge bg-dark mb-1">Preview Banner</span><br>
                            <img src="" class="banner-prev">
                        </div>
                    </div>

                    <div class="col-md-4 col-6"><label class="form-label small fw-bold">Rating</label><input type="text" id="m_rating" class="form-control" placeholder="8.5"></div>
                    <div class="col-md-4 col-6"><label class="form-label small fw-bold">Tahun</label><input type="text" id="m_year" class="form-control" placeholder="2024"></div>
                    <div class="col-md-4 col-12"><label class="form-label small fw-bold">Negara</label><input type="text" id="m_country" class="form-control" placeholder="Indonesia"></div>
                    
                    <div class="col-12"><label class="form-label small fw-bold">Genre</label><input type="text" id="m_genre" class="form-control" placeholder="Drama, Komedi"></div>
                    <div class="col-12"><label class="form-label small fw-bold">Pemeran</label><input type="text" id="m_cast" class="form-control" placeholder="Nama Artis, Nama Artis"></div>
                    <div class="col-12"><label class="form-label small fw-bold">Sinopsis</label><textarea id="m_synopsis" class="form-control" rows="3"></textarea></div>
                </div>
            </div>

            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="section-title mb-0"><i class="fa fa-list-ol me-2"></i> EPISODE / SERVER</h4>
                    <button class="btn btn-primary btn-sm" onclick="addEpisode()"><i class="fa fa-plus me-1"></i> Tambah</button>
                </div>
                <div id="episodeContainer"></div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="sticky-code">
                <button class="btn btn-success btn-lg w-100 mb-3" onclick="generateCode()">
                    <i class="fa fa-code me-2"></i>GENERATE KODE
                </button>
                <div class="position-relative">
                    <textarea id="finalCode" class="form-control" readonly placeholder="Kode HTML akan muncul di sini..."></textarea>
                    <button class="btn btn-light btn-sm position-absolute top-0 end-0 m-2" onclick="copyCode()">
                        <i class="fa fa-copy"></i> Salin
                    </button>
                </div>
                <p class="text-muted small mt-2"><i class="fa fa-info-circle me-1"></i> Salin kode di atas dan tempel di mode <b>HTML View</b> postingan Blogger.</p>
            </div>
        </div>
    </div>
</div>

<script>
    let epCount = 0;

    function showPreview(input, previewId) {
        const container = document.getElementById(previewId);
        const img = container.querySelector('img');
        if (input.value.trim() !== "") {
            img.src = input.value;
            container.style.display = "block";
        } else {
            container.style.display = "none";
        }
    }

    function resetForm() {
        if(confirm("Hapus semua data yang sudah diisi?")) {
            document.querySelectorAll('input, textarea').forEach(el => el.value = '');
            document.getElementById('episodeContainer').innerHTML = '';
            document.querySelectorAll('.preview-container').forEach(el => el.style.display = 'none');
            epCount = 0;
            addEpisode();
            window.scrollTo(0,0);
        }
    }

    function addEpisode(data = null) {
        epCount++;
        const div = document.createElement('div');
        div.className = 'episode-card';
        div.id = `ep-block-${epCount}`;
        div.innerHTML = `
            <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="badge bg-primary">Item #${epCount}</span>
                <span class="btn-remove small" onclick="this.parentElement.parentElement.remove()"><i class="fa fa-times"></i> Hapus</span>
            </div>
            <div class="row g-2">
                <div class="col-md-4"><input type="text" class="form-control form-control-sm ep-name" placeholder="Judul (EP 01 / Trailer)" value="${data ? data.name : ''}"></div>
                <div class="col-md-8"><input type="text" class="form-control form-control-sm ep-video" placeholder="Link Iframe / Video Preview" value="${data ? data.video : ''}"></div>
            </div>
            <div class="dl-container mt-3">
                <div class="small fw-bold mb-2 text-secondary"><i class="fa fa-link me-1"></i> Link Download:</div>
            </div>
            <button class="btn btn-sm btn-outline-secondary w-100 border-dashed" onclick="addDownload(this)"><i class="fa fa-plus-circle me-1"></i> Tambah Link Download</button>
        `;
        document.getElementById('episodeContainer').appendChild(div);

        if (data && data.downloads) {
            const btn = div.querySelector('button');
            data.downloads.forEach(dl => addDownload(btn, dl));
        }
    }

    function addDownload(btn, dlData = null) {
        const container = btn.previousElementSibling;
        const row = document.createElement('div');
        row.className = 'row g-2 download-row';
        row.innerHTML = `
            <div class="col-5"><input type="text" class="form-control form-control-sm dl-label" placeholder="Label (ex: 1080p)" value="${dlData ? dlData.label : ''}"></div>
            <div class="col-6"><input type="text" class="form-control form-control-sm dl-link" placeholder="URL Download" value="${dlData ? dlData.link : ''}"></div>
            <div class="col-1 d-flex align-items-center justify-content-center"><span class="btn-remove" onclick="this.parentElement.parentElement.remove()">Ã—</span></div>
        `;
        container.appendChild(row);
    }

    function importData() {
        const rawCode = document.getElementById('importCodeArea').value;
        if (!rawCode) return alert("Tempelkan kode terlebih dahulu!");

        try {
            const epMatch = rawCode.match(/const episodes = (\[[\s\S]*?\]);/);
            if (!epMatch) throw new Error("Format tidak valid.");
            const parsedEps = JSON.parse(epMatch[1]);

            const extract = (regex) => {
                const m = rawCode.match(regex);
                return m ? m[1] : '';
            };

            document.getElementById('m_title').value = extract(/<h2.*?>(.*?)<\/h2>/);
            document.getElementById('m_poster').value = extract(/class="post-poster" src="(.*?)"/);
            document.getElementById('m_banner').value = extract(/class="post-banner" src="(.*?)"/);
            document.getElementById('m_rating').value = extract(/<b>Rating<\/b> <span class="val">(.*?)<\/span>/).replace(' / 10', '');
            document.getElementById('m_year').value = extract(/<b>Tahun<\/b> <span class="val">(.*?)<\/span>/);
            document.getElementById('m_country').value = extract(/<b>Negara<\/b> <span class="val">(.*?)<\/span>/);
            document.getElementById('m_genre').value = extract(/<b>Genre<\/b> <span class="val">(.*?)<\/span>/);
            document.getElementById('m_cast').value = extract(/<b>Pemeran<\/b> <span class="val">(.*?)<\/span>/);
            document.getElementById('m_synopsis').value = extract(/<p class="text-dim small".*?>(.*?)<\/p>/);

            showPreview(document.getElementById('m_poster'), 'poster_p');
            showPreview(document.getElementById('m_banner'), 'banner_p');

            document.getElementById('episodeContainer').innerHTML = '';
            epCount = 0;
            parsedEps.forEach(ep => addEpisode(ep));

            alert("Data berhasil dimuat!");
        } catch (e) {
            alert("Gagal import. Pastikan kode yang ditempel adalah kode hasil generate sebelumnya.");
        }
    }

    function generateCode() {
        const data = {
            title: document.getElementById('m_title').value,
            poster: document.getElementById('m_poster').value,
            banner: document.getElementById('m_banner').value,
            rating: document.getElementById('m_rating').value,
            year: document.getElementById('m_year').value,
            country: document.getElementById('m_country').value,
            genre: document.getElementById('m_genre').value,
            cast: document.getElementById('m_cast').value,
            synopsis: document.getElementById('m_synopsis').value,
        };

        let eps = [];
        document.querySelectorAll('.episode-card').forEach(card => {
            let downloads = [];
            card.querySelectorAll('.download-row').forEach(dlRow => {
                const label = dlRow.querySelector('.dl-label').value;
                const link = dlRow.querySelector('.dl-link').value;
                if(label && link) downloads.push({ label, link });
            });
            eps.push({
                name: card.querySelector('.ep-name').value || 'Episode',
                video: card.querySelector('.ep-video').value,
                downloads: downloads
            });
        });

        const code = `<style>
  .post-top-wrapper { display: flex; flex-direction: column-reverse; }
  .post-header-info { margin-top: -120px; }
  @media (max-width: 992px) { .post-header-info { margin-top: -50px; } }
  .episode-item.active { background: var(--accent); color: #000; font-weight: bold; }
  .btn-download { display: inline-flex; align-items: center; padding: 8px 16px; background: #333; color: #fff; border-radius: 4px; text-decoration: none; font-size: 13px; transition: 0.3s; }
  .btn-download:hover { background: #000; color: var(--accent); }
</style>

<div class="post-top-wrapper">
   <div class="post-header-info">
      <div class="post-info-grid">
         <div class="poster-side">
            <img class="post-poster" src="${data.poster}" alt="Poster" />
         </div>
         <div class="info-side">
            <h2 class="fw-bold mb-3 text-main">${data.title}</h2>
            <ul class="info-list">
               <li><b>Rating</b> <span class="val">${data.rating} / 10</span></li>
               <li><b>Tahun</b> <span class="val">${data.year}</span></li>
               <li><b>Negara</b> <span class="val">${data.country}</span></li>
               <li><b>Genre</b> <span class="val">${data.genre}</span></li>
               <li><b>Pemeran</b> <span class="val">${data.cast}</span></li>
            </ul>
            <div class="synopsis-wrapper">
               <h6 class="text-info fw-bold small text-uppercase mb-2">Sinopsis</h6>
               <p class="text-dim small" style="line-height:1.6; text-align:justify;">${data.synopsis}</p>
            </div>
         </div>
      </div>
   </div>
   <img class="post-banner" src="${data.banner}" alt="Banner" />
</div>

<div class="video-container">
   <iframe id="videoPlayer" src="${eps[0]?.video || ''}" allowfullscreen="true"></iframe>
</div>

<div class="download-section">
   <h5 class="fw-bold mb-3 text-main"><i class="fa fa-download me-2"></i> LINK DOWNLOAD <span id="epTitle">(${eps[0]?.name || ''})</span></h5>
   <div class="mb-3">
      <div id="dlButtons" class="d-flex flex-wrap gap-2"></div>
      <p id="noDownload" class="text-secondary small" style="display:none;">Link download tidak tersedia</p>
   </div>
  <h6 class="small fw-bold text-secondary mt-4">Pilih Episode / Server:</h6>
  <div id="episodeList" class="episode-list"></div>
</div>

<script>
const episodes = ${JSON.stringify(eps, null, 2)};

function renderEpisodes() {
    const container = document.getElementById('episodeList');
    container.innerHTML = ''; 
    const hashIndex = window.location.hash ? parseInt(window.location.hash.replace('#ep', '')) : 0;
    const startIndex = (hashIndex >= 0 && hashIndex < episodes.length) ? hashIndex : 0;

    episodes.forEach((ep, index) => {
        const btn = document.createElement('a');
        btn.href = "#ep" + index;
        btn.className = "episode-item";
        btn.innerText = ep.name;
        if (index === startIndex) btn.classList.add('active');
        btn.onclick = (e) => {
            e.preventDefault();
            setActiveEpisode(index, btn);
        };
        container.appendChild(btn);
    });

    setActiveEpisode(startIndex, document.querySelectorAll('.episode-item')[startIndex]);
}

function setActiveEpisode(index, element) {
    if(!element) return;
    const data = episodes[index];
    window.location.hash = "ep" + index;
    document.getElementById('videoPlayer').src = data.video;
    document.getElementById('epTitle').innerText = "(" + data.name + ")";
    
    const dlBox = document.getElementById('dlButtons');
    const noDlText = document.getElementById('noDownload');
    dlBox.innerHTML = ''; 

    if (!data.downloads || data.downloads.length === 0) {
        dlBox.style.display = 'none';
        noDlText.style.display = 'block';
    } else {
        dlBox.style.display = 'flex';
        noDlText.style.display = 'none';
        data.downloads.forEach(dl => {
            const a = document.createElement('a');
            a.href = dl.link;
            a.target = "_blank";
            a.className = "btn-download";
            a.innerHTML = \`<i class="fa fa-download me-2"></i> \${dl.label}\`;
            dlBox.appendChild(a);
        });
    }
    document.querySelectorAll('.episode-item').forEach(btn => btn.classList.remove('active'));
    element.classList.add('active');
}
renderEpisodes();
<\/script>`;

        document.getElementById('finalCode').value = code;
        alert("Kode berhasil di-generate!");
    }

    function copyCode() {
        const copyText = document.getElementById("finalCode");
        copyText.select();
        document.execCommand("copy");
        alert("Kode disalin!");
    }

    addEpisode();
</script>
</body>
</html>
